# GSS Portfolio - n8n + Supabase Integration

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI Vision API –∏ State Machine –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏.

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

–î–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö workflow –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–Ω–¥–µ—Ä–æ–≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏:

| Workflow | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|-----------|
| **GSS-01: Vision Analysis** | –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ AI Vision API |
| **GSS-02: Retry Logic State Machine** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ |

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        GSS-01: Vision Analysis                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  Webhook ‚îÄ‚îÄ‚Üí Check ‚îÄ‚îÄ‚Üí IF ‚îÄ‚îÄ‚Üí Create ‚îÄ‚îÄ‚Üí Set ‚îÄ‚îÄ‚Üí Perplexity ‚îÄ‚îÄ‚Üí ‚îÇ
‚îÇ  (image)    Duplicate      Job     Processing   Vision API       ‚îÇ
‚îÇ                ‚îÇ                                     ‚îÇ           ‚îÇ
‚îÇ                ‚ñº                                     ‚ñº           ‚îÇ
‚îÇ            [STOP]                              Parse Response    ‚îÇ
‚îÇ                                                     ‚îÇ           ‚îÇ
‚îÇ                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                    ‚ñº                ‚ñº           ‚îÇ
‚îÇ                              [SUCCESS]          [FAIL]          ‚îÇ
‚îÇ                              Save Render      Save Error        ‚îÇ
‚îÇ                              Set CLASSIFIED   Set FAILED        ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   GSS-02: Retry Logic State Machine              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  Webhook ‚îÄ‚îÄ‚Üí Get Last ‚îÄ‚îÄ‚Üí Calculate ‚îÄ‚îÄ‚Üí Switch ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ  (QC Result)  Attempt      Params       Action                   ‚îÇ
‚îÇ                                           ‚îÇ                      ‚îÇ
‚îÇ                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ                          ‚ñº                ‚ñº                ‚ñº     ‚îÇ
‚îÇ                       [RETRY]        [FATAL_ERROR]    [SUCCESS]  ‚îÇ
‚îÇ                          ‚îÇ                ‚îÇ                ‚îÇ     ‚îÇ
‚îÇ                          ‚ñº                ‚ñº                ‚ñº     ‚îÇ
‚îÇ                    Nano Banana     Set Manual Review  Set Complete‚îÇ
‚îÇ                    API Call        Save Fatal Attempt Save Success‚îÇ
‚îÇ                          ‚îÇ                ‚îÇ                      ‚îÇ
‚îÇ                          ‚ñº                ‚ñº                      ‚îÇ
‚îÇ                    Save Attempt     Slack Alert                  ‚îÇ
‚îÇ                    Set Generating                                ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
gss-portfolio/
‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îú‚îÄ‚îÄ gss01-vision-analysis.json    # Workflow 1: Vision Analysis
‚îÇ   ‚îî‚îÄ‚îÄ gss02-retry-logic.json        # Workflow 2: Retry State Machine
‚îú‚îÄ‚îÄ screenshots/
‚îÇ   ‚îú‚îÄ‚îÄ gss01-workflow.png            # –û–±—â–∏–π –≤–∏–¥ GSS-01
‚îÇ   ‚îú‚îÄ‚îÄ gss02-workflow.png            # –û–±—â–∏–π –≤–∏–¥ GSS-02
‚îÇ   ‚îú‚îÄ‚îÄ gss02-switch-node.png         # Switch - Action –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ supabase-tables.png           # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
‚îú‚îÄ‚îÄ queries.sql                        # SQL —Å—Ö–µ–º–∞ –∏ –∑–∞–ø—Ä–æ—Å—ã
‚îî‚îÄ‚îÄ README.md                          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Supabase)

### –¢–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|-----------|
| `jobs` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏ |
| `renders` | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |
| `generation_attempts` | –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø—ã—Ç–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |

### JSONB –ø–æ–ª—è

```sql
-- technical_tags –≤ renders
technical_tags JSONB DEFAULT '[]'::jsonb
-- –ü—Ä–∏–º–µ—Ä: ["interior", "living_room", "modern"]

-- parameters –≤ generation_attempts  
parameters JSONB DEFAULT '{"steps": 50, "sampler": "DPM++", "cfg_scale": 7.5, "structure_scale": 0.50}'::jsonb

-- –ó–∞–ø—Ä–æ—Å –ø–æ —Ç–µ–≥–∞–º
SELECT * FROM renders WHERE technical_tags @> '["interior"]';
```

### Views –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- `v_jobs_stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- `v_recent_renders` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ä–µ–Ω–¥–µ—Ä—ã
- `v_retry_stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- `v_recent_attempts` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –ø–æ–ø—ã—Ç–æ–∫

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –ò–º–ø–æ—Ä—Ç –≤ n8n

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π workflow
3. –ù–∞–∂–º–∏—Ç–µ **Import from File**
4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON –∏–∑ –ø–∞–ø–∫–∏ `workflows/`

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ [Supabase](https://supabase.com)
2. –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç `queries.sql`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Credentials –≤ n8n

1. **Supabase**: URL + Service Role Key
2. **HTTP Header Auth**: OpenRouter API Key
3. **Slack** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): Webhook URL

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GSS-01

```bash
curl -X POST https://your-n8n.cloud/webhook/new-render \
  -H "Content-Type: application/json" \
  -d '{
    "property_id": "550e8400-e29b-41d4-a716-446655440000",
    "image_url": "https://example.com/render.jpg"
  }'
```

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GSS-02

```bash
curl -X POST https://your-n8n.cloud/webhook/gss02-qc-result \
  -H "Content-Type: application/json" \
  -d '{
    "job_id": "550e8400-e29b-41d4-a716-446655440000",
    "render_id": "existing-render-uuid",
    "qc_result": {
      "verdict": "FAIL",
      "reason": "Geometry distortion",
      "confidence": 0.85,
      "suggested_fix": "increase_structure_strength"
    }
  }'
```

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

### 1. –†–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚úÖ
- OpenRouter API (google/gemini-2.0-flash) –¥–ª—è Vision Analysis
- Supabase –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î (jobs, renders)

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ‚úÖ
- **Timeout**: 60 —Å–µ–∫—É–Ω–¥ + "Continue on fail"
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: Check Duplicate –Ω–æ–¥–∞ –ø–æ property_id
- **Try-Catch**: –ü–∞—Ä—Å–∏–Ω–≥ JSON —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

### 3. JSONB ‚úÖ
- `technical_tags` ‚Äî –º–∞—Å—Å–∏–≤ —Ç–µ–≥–æ–≤
- `parameters` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `full_analysis` ‚Äî –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç AI
- SQL –∑–∞–ø—Ä–æ—Å—ã: `WHERE technical_tags @> '["interior"]'`

### 4. –ö–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç ‚úÖ
- –°—Ç–∞—Ç—É—Å—ã: QUEUED ‚Üí PROCESSING ‚Üí CLASSIFIED/FAILED
- Retry: RETRY ‚Üí FATAL_ERROR ‚Üí MANUAL_REVIEW
- –õ–∏–º–∏—Ç: 3 –ø–æ–ø—ã—Ç–∫–∏, –∑–∞—Ç–µ–º —ç—Å–∫–∞–ª–∞—Ü–∏—è
- –ù–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤

### 5. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∞ ‚úÖ
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ü–æ–Ω—è—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–æ–¥
- –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ:

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á
SELECT * FROM v_jobs_stats;

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä—ã
SELECT * FROM v_recent_renders LIMIT 10;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ retry
SELECT * FROM v_retry_stats;
```

## üîß –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (GSS-02)

| suggested_fix | –î–µ–π—Å—Ç–≤–∏–µ |
|--------------|----------|
| `increase_structure_strength` | structure_scale += 0.10 (max 1.0) |
| `reduce_artifacts` | cfg_scale -= 0.5 (min 3.0) |
| `increase_detail` | cfg_scale += 0.5 (max 15.0) |
| `smooth_geometry` | structure_scale -= 0.05 (min 0.2) |


